# Story 4.1: Customizable Data Visualization Dashboard

## Status
Draft

## Story
**As a** Solar Asset Manager,  
**I want** a customizable dashboard where I can select any database columns for X and Y axes to create visualizations,  
**so that** I can explore correlations between different solar performance metrics and generate insights on demand.

## Acceptance Criteria
1. A customizable dashboard section is added below the "View Site Portfolio" button on the landing page
2. The dashboard contains two dropdown selectors: one for X-axis and one for Y-axis
3. Both dropdowns are populated with all available columns from the Redshift database schema tables
4. A "Generate Chart" button triggers the visualization creation
5. The AI intelligently determines the appropriate chart type based on the selected data types
6. The AI queries the most recent month's data from the dataanalytics.public.desri_[SITE]_[YEAR]_[MONTH] tables
7. The generated chart displays the correlation between the selected X and Y axis metrics
8. The AI provides contextual insights about the visualization when generated

## Tasks / Subtasks

- [ ] Task 1: Create Beautiful Dashboard UI Components (AC: 1, 2, 4)
  - [ ] Add elegant dashboard section container with subtle border/shadow below "View Site Portfolio" button
  - [ ] Create sleek dropdown component for X-axis selection using ShadCN/UI Select with search/filter capability
  - [ ] Create matching dropdown component for Y-axis selection with consistent styling
  - [ ] Add polished "Generate Chart" button with loading state and hover animations
  - [ ] Implement responsive grid layout for dropdowns (2-column on desktop, 1-column on mobile)
  - [ ] Add smooth micro-interactions and transitions using Framer Motion

- [ ] Task 2: Implement Column Schema API (AC: 3)
  - [ ] Create backend endpoint `GET /api/schema/columns` to return all available database columns
  - [ ] Parse Redshift schema to extract column names and data types from all relevant tables
  - [ ] Group columns by table and include metadata (column name, data type, table source)
  - [ ] Return structured JSON with column information for frontend consumption

- [ ] Task 3: Extend AI Query Service (AC: 5, 6, 7, 8)
  - [ ] Modify existing `/api/query` endpoint to handle custom chart requests
  - [ ] Add logic to auto-determine chart type based on column data types (scatter, line, bar, etc.)
  - [ ] Implement dynamic SQL query generation for selected X/Y axis columns
  - [ ] Add logic to determine most recent month's data table for querying
  - [ ] Generate contextual insights about the visualization correlation

- [ ] Task 4: Smooth Frontend Integration & Visualization (AC: 4, 7)
  - [ ] Connect dropdowns to schema API with elegant loading skeletons during data fetch
  - [ ] Implement smooth form submission with React Hook Form for optimal UX
  - [ ] Add beautiful loading spinner/progress indicator during chart generation
  - [ ] Integrate with AI query service and display charts using Recharts with smooth animations
  - [ ] Implement chart container with proper responsive sizing and elegant hover states
  - [ ] Add toast notifications for success/error states using Sonner
  - [ ] Include smooth chart transitions when switching between different visualizations

- [ ] Task 5: Testing (All AC)
  - [ ] Write unit tests for dropdown components
  - [ ] Write unit tests for schema API endpoint
  - [ ] Write integration tests for AI query service extensions
  - [ ] Write E2E tests for complete dashboard workflow
  - [ ] Test with various column combinations and data types

## Dev Notes

### Architecture Context
[Source: docs/architecture/3-tech-stack.md] The frontend uses Next.js 14+ with TypeScript 5.4+, ShadCN/UI components, and TanStack Query for server state management. Backend uses FastAPI with Python 3.11+.

[Source: docs/architecture/9-frontend-architecture.md] Components should follow feature-based structure (`components/ui`, `components/features`) with Zustand for global state and Next.js App Router for routing.

[Source: docs/architecture/5-api-specification.md] The existing `/api/query` endpoint should be extended rather than creating a new endpoint for AI functionality.

### Database Schema Integration
Based on the Redshift schema, the following table structures contain relevant columns for visualization:
- `flash_data`: p_mw (float), poa (float), ghi (float), bom_temp (float), air_temp (float)
- `inverter_data`: p_kw (float), poa (float), availability (float)
- `power_curves`: air_density (float), windspeed (float), power_kw (float)

The most recent data should be queried from `dataanalytics.public.desri_[SITE]_[YEAR]_[MONTH]` tables using current date logic.

### Technical Implementation Notes
- Use existing AI service architecture for query processing and chart generation
- Leverage existing chart visualization components from previous stories
- Implement proper error handling for invalid column combinations
- Consider performance implications when querying large datasets

### Recommended Libraries for Beautiful UI & Smooth UX
**For Dropdowns & Form Controls:**
- `@radix-ui/react-select` or ShadCN/UI Select component for beautiful, accessible dropdowns
- `react-hook-form` with `@hookform/resolvers/zod` for smooth form handling and validation

**For Charts & Visualizations:**
- `recharts` - Simple, composable, and beautiful React charts (recommended for ease of use)
- Alternative: `@nivo/core` with specific chart components for more advanced styling options
- `framer-motion` for smooth chart animations and transitions

**For Loading States & Interactions:**
- `react-loading-skeleton` for beautiful loading placeholders
- `sonner` or `react-hot-toast` for elegant toast notifications
- `lucide-react` icons for consistent, modern iconography

**For Layout & Styling:**
- Existing `tailwindcss` with `tailwind-merge` and `clsx` for dynamic class management
- `@tailwindcss/container-queries` for responsive chart containers
- CSS Grid and Flexbox for dashboard layout (native CSS, no additional libraries needed)

**Implementation Priority:**
1. Keep it simple - use ShadCN/UI components wherever possible (already in tech stack)
2. Recharts for visualization (lightweight, well-documented, React-native)
3. Framer Motion for smooth transitions between chart states
4. React Hook Form for buttery-smooth dropdown interactions

### Testing Standards
[Source: docs/architecture/15-testing-strategy.md] Follow testing pyramid: many unit tests, some integration tests, few E2E tests. Use Jest & RTL for frontend, Pytest for backend, Playwright for E2E.

Test files should be located:
- Frontend: `apps/frontend/src/components/__tests__/`
- Backend: `apps/backend/tests/`
- E2E: `apps/frontend/tests/e2e/`

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-04 | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record
*(This section will be populated by the development agent during implementation)*

### Agent Model Used
*(To be filled by dev agent)*

### Debug Log References
*(To be filled by dev agent)*

### Completion Notes List
*(To be filled by dev agent)*

### File List
*(To be filled by dev agent)*

## QA Results
*(Results from QA Agent review will be populated here)*