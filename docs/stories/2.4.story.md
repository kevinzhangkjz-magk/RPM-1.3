# Story 2.4: GHI/POA Sensor View Toggle

## Status
Draft

## Story
**As a** Solar Asset Manager,
**I want** to switch my power curve analysis between using Plane of Array (POA) and Global Horizontal Irradiance (GHI),
**so that** I can validate sensor data and analyze performance from different perspectives.

## Acceptance Criteria
1. The backend API is updated to accept a parameter to switch between POA and GHI data.
2. The analysis views contain a UI toggle to switch the power curve's X-axis and data.
3. The chart and all related statistics update correctly when the view is toggled.

## Tasks / Subtasks
- [ ] **Backend**: Modify the three performance data endpoints to accept a new query parameter.
- [ ] **Backend**: In the DAL, update the SQL queries to dynamically select the correct irradiance column.
- [ ] **Backend**: Update the Pytest tests for all three endpoints.
- [ ] **Frontend**: Update the TanStack Query functions to accept the `irradiance_type` parameter.
- [ ] **Frontend**: Add a UI control to the analysis views to select "POA" or "GHI".
- [ ] **Frontend**: Connect the UI toggle to the TanStack Query function to refetch data.
- [ ] **Frontend**: Ensure the chart's X-axis label and all calculations update correctly.
- [ ] **Frontend**: Write/update Jest/RTL tests to verify the toggle control works.

## Dev Notes
The developer must modify both the backend and frontend to support this feature.

### API Endpoint to Modify
* `GET /api/sites/{site_id}/performance`
* `GET /api/sites/{site_id}/skids`
* `GET /api/skids/{id}/inverters`


### UI/UX Guidance
* The UI should include a clear and intuitive control, such as a button group, as shown in the wireframes.
* When the toggle is changed, the chart should re-fetch data and re-render smoothly, providing a loading indicator during the fetch.


## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-07-29 | 1.0 | Story created | Bob (SM) |

## Dev Agent Record
*This section to be filled out by the Developer Agent during implementation.*

## QA Results
*This section to be filled out by the QA Agent during review.*