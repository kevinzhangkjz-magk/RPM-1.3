Of course. Here is the clean, "Draft" version of **Story 1.4**, as it would be presented to a developer before any work begins.

-----

### **Story 1.4: Site-Level Power Curve Visualization (Draft Version)**

````markdown
# Story 1.4: Site-Level Power Curve Visualization

## Status
Draft

## Story
**As a** Solar Asset Manager,
**I want** to view a power curve chart for a selected site,
**so that** I can visually compare its actual performance against the expected model.

## Acceptance Criteria
1. The Site Analysis View displays a chart after a site is selected.
2. The chart's X-axis represents Plane of Array (POA) Irradiance and the Y-axis represents Power.
3. The chart plots 'actual power' data points using a distinct color (e.g., blue).
4. The chart plots 'expected power' data points using a different distinct color (e.g., grey).
5. The chart also displays the 'expected power' model as a separate trend line (e.g., a red line).
6. The user can toggle the visibility of the actual data points, expected data points, and the expected trend line on and off independently.
7. The chart displays the calculated RMSE and R-squared values for the selected data.
8. The chart successfully fetches and renders data from the backend API created in Story 1.2.

## Tasks / Subtasks
- [ ] In the `apps/web` project, develop the UI for the Site Analysis View page (`/app/portfolio/[siteId]/page.tsx`).
- [ ] Use the `siteId` from the URL parameters to fetch data from the `GET /api/sites/{site_id}/performance` endpoint using the TanStack Query service function.
- [ ] Integrate a charting library (e.g., Recharts) to render the scatter plot and trend line for the power curve.
- [ ] Configure the chart to plot the 'actual' and 'expected' power data points with different colors.
- [ ] Add the 'expected' power trend line to the chart.
- [ ] Implement UI controls (e.g., ShadCN `Switch` components) to toggle the visibility of the three data series.
- [ ] Implement the client-side logic to calculate RMSE and R-squared from the fetched data.
- [ ] Display the calculated RMSE and R-squared values in `KPI Card` components.
- [ ] Write Jest/RTL unit tests for the page, mocking the API call and verifying that the chart and KPIs render correctly.

## Dev Notes
The developer must build the UI according to the wireframe defined in the UI/UX Specification.

### Site Analysis View Wireframe
```text
+------------------------------------------------------+---------------------------+
| [Chart Title] Power Curve - Site: [Site Name]        | [Card] RMSE               |
|                                                      |      1.2 MW               |
|         [       POWER CURVE VISUALIZATION      ]     |---------------------------|
|         (Actual vs. Expected)                        | [Card] R-Squared          |
|                                                      |      0.95                 |
|                                                      |---------------------------|
|                                                      | [Table] Skid Performance  |
|                                                      |  - Skid 01 | -5.1%        |
|                                                      |  - ... (Clickable Rows)   |
+------------------------------------------------------+---------------------------+
| [Controls] [Toggle Actual] [Toggle Expected] [Toggle Trend] [Button Group: POA|GHI]|
+----------------------------------------------------------------------------------+
````

## Change Log

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-07-29 | 1.0 | Story created | Bob (SM) |

## Dev Agent Record

*This section to be filled out by the Developer Agent during implementation.*

## QA Results

*This section to be filled out by the QA Agent during review.*